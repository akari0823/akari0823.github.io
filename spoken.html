<!DOCTYPE html>
<html lang="ja">
<head>
<style>
body {
    font-family: 'Comic Sans MS', cursive, sans-serif;
    background-color: #f2f2f2;
    margin: 0;
    padding: 0;
}

.container {
	text-align: center;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
}

h1, h2 {
    text-align: center;
    color: #333;
}

button {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 5px;
}

button:hover {
    background-color: #0056b3;
}

input[type="button"] {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 5px 10px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 3px;
}

input[type="button"]:hover {
    background-color: #1e7e34;
}

#resultOutput {
    margin-top: 20px;
    font-size: 16px;
    color: #555;
}

p {
    font-size: 14px;
    color: #666;
    text-align: center;
    margin: 10px 0;
}

.credit {
    font-size: 12px;
    color: #999;
    text-align: center;
}
</style>
<meta http-equiv="content-script-type" content="text/javascript">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>音声入力でYahoo! JAPAN Web APIを利用するサンプル（位置情報検索）</title>
</head>
<body>

<div class="container">
    <h1>緯度と経度を調べてみよう！</h1>
    <h2>街の名前を言ってみてね！</h2>
    <button onclick="startSpeechRecognition()">話しかける</button>
    <p>
        <input name="query" id="query" value="">
        <input type="button" value="検索" onclick="showAddress()">
    </p>

    <div id="resultOutput"></div>
	<p>参考：<br>
    JSONPを使ってJavaScriptだけでマッシュアップ：<a href="https://techblog.yahoo.co.jp/javascript/jsonpjavascript/" target="_blank">https://techblog.yahoo.co.jp/javascript/jsonpjavascript/</a><br>
    Yahoo!ジオコーダAPI：<a href="https://developer.yahoo.co.jp/webapi/map/openlocalplatform/v1/geocoder.html" target="_blank">https://developer.yahoo.co.jp/webapi/map/openlocalplatform/v1/geocoder.html</a></p>

    <p class="credit">
        Web Services by Yahoo! JAPAN（<a href="https://developer.yahoo.co.jp/sitemap/" target="_blank">https://developer.yahoo.co.jp/sitemap/</a>）
    </p>
</div>

<script type="text/javascript">
<!--
// 音声入力で住所の情報を表示する
function startSpeechRecognition() {
  if ('webkitSpeechRecognition' in window) {
    var recognition = new webkitSpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onresult = function(event) {
      var result = event.results[0][0].transcript;
      document.getElementById('query').value = result;
      showAddress();
    };

    recognition.start();
  } else {
    alert('音声認識がサポートされていません。');
  }
}

//住所の情報を表示する
function showAddress() {
  //var appid = '個人api';
  var appid = 'dj00aiZpPXZKUXRxbUN5ZzU5eSZzPWNvbnN1bWVyc2VjcmV0Jng9MDI-';
  var query = document.getElementById('query').value;
  var url = "https://map.yahooapis.jp/geocode/V1/geoCoder?appid=" + appid + "&query=" + encodeURI( query ) + "&output=json&callback=showResult";
  callJSONP( url );
}

//JSONPを実行する関数
function callJSONP(url) {
  console.log(url);
  var target = document.createElement('script');
  target.charset = 'utf-8';
  target.src = url;
  document.body.appendChild(target);
}

//JSONPの結果として実行される関数
function showResult( result ) {
  let output = '';

  //console.log(result);
  console.log(result.Feature);
  for(let i = 0; i < result.Feature.length; i++){
    console.log(result.Feature[i]);
    let name = result.Feature[i].Name;
    let location = result.Feature[i].Geometry.Coordinates;
    output += name + "/" + location + "<br>";
    document.getElementById('resultOutput').innerHTML = output;
  }
  
}
--></script>
</body>
</html>
