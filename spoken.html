<!DOCTYPE html>
<html lang="ja">
<head>
<style>
h1{
	text-align:center;
	}
h2{
	text-align:center;
	}
</style>
<meta http-equiv="content-script-type" content="text/javascript">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>音声入力でYahoo! JAPAN Web APIを利用するサンプル（位置情報検索）</title>
</head>
<body>

<h1>緯度と経度を調べてみましょう</h1>
<h2>調べたい街の名前を教えてください</h2>
<p>
参考：<br>
JSONPを使ってJavaScriptだけでマッシュアップ：https://techblog.yahoo.co.jp/javascript/jsonpjavascript/<br>
Yahoo!ジオコーダAPI: https://developer.yahoo.co.jp/webapi/map/openlocalplatform/v1/geocoder.html
</p>

<!-- 音声入力を受け取るボタン -->
<button onclick="startSpeechRecognition()">教える</button>

<p>
<input name="query" id="query" value="" >
<input type="button" value="実行" onclick="showAddress()">
</p>

<p>
<div id="resultOutput"></div>
</p>

<script type="text/javascript">
<!--
// 音声入力で住所の情報を表示する
function startSpeechRecognition() {
  if ('webkitSpeechRecognition' in window) {
    var recognition = new webkitSpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onresult = function(event) {
      var result = event.results[0][0].transcript;
      document.getElementById('query').value = result;
      showAddress();
    };

    recognition.start();
  } else {
    alert('音声認識がサポートされていません。');
  }
}

//住所の情報を表示する
function showAddress() {
  //var appid = '個人api';
  var appid = 'dj00aiZpPXZKUXRxbUN5ZzU5eSZzPWNvbnN1bWVyc2VjcmV0Jng9MDI-';
  var query = document.getElementById('query').value;
  var url = "https://map.yahooapis.jp/geocode/V1/geoCoder?appid=" + appid + "&query=" + encodeURI( query ) + "&output=json&callback=showResult";
  callJSONP( url );
}

//JSONPを実行する関数
function callJSONP(url) {
  console.log(url);
  var target = document.createElement('script');
  target.charset = 'utf-8';
  target.src = url;
  document.body.appendChild(target);
}

//JSONPの結果として実行される関数
function showResult( result ) {
  let output = '';

  //console.log(result);
  console.log(result.Feature);
  for(let i = 0; i < result.Feature.length; i++){
    console.log(result.Feature[i]);
    let name = result.Feature[i].Name;
    let location = result.Feature[i].Geometry.Coordinates;
    output += name + "/" + location + "<br>";
    document.getElementById('resultOutput').innerHTML = output;
  }
  
}
-->
</script>

<!-- Yahoo!JAPANのAPIを利用したときはクレジット表記が必要 -->
<p>
Web Services by Yahoo! JAPAN （https://developer.yahoo.co.jp/sitemap/）
</p>
</body>
</html>
